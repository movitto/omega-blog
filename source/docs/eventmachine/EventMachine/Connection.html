<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: EventMachine::Connection
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../EventMachine.html" title="EventMachine (module)">EventMachine</a></span></span>
     &raquo; 
    <span class="title">Connection</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: EventMachine::Connection
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">EventMachine::Connection</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/em/connection.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>EventMachine::Connection is a class that is instantiated
by EventMachine’s processing loop whenever a new connection
is created. (New connections can be either initiated locally
to a remote server or accepted locally from a remote client.)
When a Connection object is instantiated, it <i>mixes in</i>
the functionality contained in the user-defined module
specified in calls to <span class='object_link'><a href="../EventMachine.html#connect-class_method" title="EventMachine.connect (method)">connect</a></span> or <span class='object_link'><a href="../EventMachine.html#start_server-class_method" title="EventMachine.start_server (method)">start_server</a></span>.
User-defined handler modules may redefine any or all of the standard
methods defined here, as well as add arbitrary additional code
that will also be mixed in.</p>

<p>EventMachine manages one object inherited from EventMachine::Connection
(and containing the mixed-in user code) for every network connection
that is active at any given time.
The event loop will automatically call methods on EventMachine::Connection
objects whenever specific events occur on the corresponding connections,
as described below.</p>

<p>This class is never instantiated by user code, and does not publish an
initialize method. The instance methods of EventMachine::Connection
which may be called by the event loop are:</p>

<ul>
  <li><span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span></li>
  <li><span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span></li>
  <li><span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span></li>
  <li><span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span></li>
  <li><span class='object_link'><a href="#ssl_verify_peer-instance_method" title="EventMachine::Connection#ssl_verify_peer (method)">#ssl_verify_peer</a></span> (if TLS is used)</li>
  <li><span class='object_link'><a href="#ssl_handshake_completed-instance_method" title="EventMachine::Connection#ssl_handshake_completed (method)">#ssl_handshake_completed</a></span></li>
</ul>

<p>All of the other instance methods defined here are called  only by user code.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="../file.GettingStarted.html" title="EventMachine tutorial">EventMachine tutorial</a></li>
    
  </ul>

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="DNS/Socket.html" title="EventMachine::DNS::Socket (class)">DNS::Socket</a></span>, <span class='object_link'><a href="DeferrableChildProcess.html" title="EventMachine::DeferrableChildProcess (class)">DeferrableChildProcess</a></span>, <span class='object_link'><a href="FileWatch.html" title="EventMachine::FileWatch (class)">FileWatch</a></span>, <span class='object_link'><a href="ProcessWatch.html" title="EventMachine::ProcessWatch (class)">ProcessWatch</a></span>, <span class='object_link'><a href="Protocols/HeaderAndContentProtocol.html" title="EventMachine::Protocols::HeaderAndContentProtocol (class)">Protocols::HeaderAndContentProtocol</a></span>, <span class='object_link'><a href="Protocols/HttpClient.html" title="EventMachine::Protocols::HttpClient (class)">Protocols::HttpClient</a></span>, <span class='object_link'><a href="Protocols/HttpClient2.html" title="EventMachine::Protocols::HttpClient2 (class)">Protocols::HttpClient2</a></span>, <span class='object_link'><a href="Protocols/LineAndTextProtocol.html" title="EventMachine::Protocols::LineAndTextProtocol (class)">Protocols::LineAndTextProtocol</a></span>, <span class='object_link'><a href="Protocols/Postgres3.html" title="EventMachine::Protocols::Postgres3 (class)">Protocols::Postgres3</a></span>, <span class='object_link'><a href="Protocols/SmtpClient.html" title="EventMachine::Protocols::SmtpClient (class)">Protocols::SmtpClient</a></span>, <span class='object_link'><a href="Protocols/SmtpServer.html" title="EventMachine::Protocols::SmtpServer (class)">Protocols::SmtpServer</a></span>, <span class='object_link'><a href="Protocols/Socks4.html" title="EventMachine::Protocols::Socks4 (class)">Protocols::Socks4</a></span></p>
</div>







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close_connection-instance_method" title="#close_connection (instance method)">- (Object) <strong>close_connection</strong>(after_writing = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>EventMachine::Connection#close_connection is called only by user code, and never
by the event loop.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close_connection_after_writing-instance_method" title="#close_connection_after_writing (instance method)">- (Object) <strong>close_connection_after_writing</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A variant of <span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#comm_inactivity_timeout-instance_method" title="#comm_inactivity_timeout (instance method)">- (Object) <strong>comm_inactivity_timeout</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>comm_inactivity_timeout returns the current value (float in seconds) of the inactivity-timeout
property of network-connection and datagram-socket objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#comm_inactivity_timeout%3D-instance_method" title="#comm_inactivity_timeout= (instance method)">- (Object) <strong>comm_inactivity_timeout=</strong>(value) </a>
    

    
      (also: #set_comm_inactivity_timeout)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Allows you to set the inactivity-timeout property for
a network connection or datagram socket.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connection_completed-instance_method" title="#connection_completed (instance method)">- (Object) <strong>connection_completed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Called by the event loop when a remote TCP connection attempt completes successfully.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#detach-instance_method" title="#detach (instance method)">- (Object) <strong>detach</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Removes given connection from the event loop.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#error%3F-instance_method" title="#error? (instance method)">- (Boolean) <strong>error?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns true if the connection is in an error state, false otherwise.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_idle_time-instance_method" title="#get_idle_time (instance method)">- (Object) <strong>get_idle_time</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The number of seconds since the last send/receive activity on this connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_peer_cert-instance_method" title="#get_peer_cert (instance method)">- (String) <strong>get_peer_cert</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>If <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> is active on the connection, returns the remote <a href="http://en.wikipedia.org/wiki/X.509">X509 certificate</a>
as a string, in the popular <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM format</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_peername-instance_method" title="#get_peername (instance method)">- (Object) <strong>get_peername</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>This method is used with stream-connections to obtain the identity
of the remotely-connected peer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pid-instance_method" title="#get_pid (instance method)">- (Integer) <strong>get_pid</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the PID (kernel process identifier) of a subprocess
associated with this Connection object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_proxied_bytes-instance_method" title="#get_proxied_bytes (instance method)">- (Object) <strong>get_proxied_bytes</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The number of bytes proxied to another connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_sock_opt-instance_method" title="#get_sock_opt (instance method)">- (Object) <strong>get_sock_opt</strong>(level, option) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_sockname-instance_method" title="#get_sockname (instance method)">- (Object) <strong>get_sockname</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Used with stream-connections to obtain the identity
of the local side of the connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status-instance_method" title="#get_status (instance method)">- (Integer) <strong>get_status</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a subprocess exit status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notify_readable%3D-instance_method" title="#notify_readable= (instance method)">- (Object) <strong>notify_readable=</strong>(mode) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Watches connection for readability.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notify_readable%3F-instance_method" title="#notify_readable? (instance method)">- (Boolean) <strong>notify_readable?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>True if the connection is being watched for readability.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notify_writable%3D-instance_method" title="#notify_writable= (instance method)">- (Object) <strong>notify_writable=</strong>(mode) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Watches connection for writeability.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notify_writable%3F-instance_method" title="#notify_writable? (instance method)">- (Boolean) <strong>notify_writable?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns true if the connection is being watched for writability.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pause-instance_method" title="#pause (instance method)">- (Object) <strong>pause</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Pause a connection so that <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span> and <span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span> events are not fired until <span class='object_link'><a href="#resume-instance_method" title="EventMachine::Connection#resume (method)">#resume</a></span> is called.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#paused%3F-instance_method" title="#paused? (instance method)">- (Boolean) <strong>paused?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>True if the connect was paused using <span class='object_link'><a href="#pause-instance_method" title="EventMachine::Connection#pause (method)">#pause</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_connect_timeout-instance_method" title="#pending_connect_timeout (instance method)">- (Float) <strong>pending_connect_timeout</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The duration after which a TCP connection in the connecting state will fail.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_connect_timeout%3D-instance_method" title="#pending_connect_timeout= (instance method)">- (Object) <strong>pending_connect_timeout=</strong>(value) </a>
    

    
      (also: #set_pending_connect_timeout)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sets the duration after which a TCP connection in a
connecting state will fail.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_init-instance_method" title="#post_init (instance method)">- (Object) <strong>post_init</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Called by the event loop immediately after the network connection has been established,
and before resumption of the network loop.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#proxy_completed-instance_method" title="#proxy_completed (instance method)">- (Object) <strong>proxy_completed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>called when the reactor finished proxying all
of the requested bytes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#proxy_incoming_to-instance_method" title="#proxy_incoming_to (instance method)">- (Object) <strong>proxy_incoming_to</strong>(conn, bufsize = 0) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>EventMachine::Connection#proxy_incoming_to is called only by user code.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#proxy_target_unbound-instance_method" title="#proxy_target_unbound (instance method)">- (Object) <strong>proxy_target_unbound</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Called by the reactor after attempting to relay incoming data to a descriptor (set as a proxy target descriptor with
<span class='object_link'><a href="../EventMachine.html#enable_proxy-class_method" title="EventMachine.enable_proxy (method)">enable_proxy</a></span>) that has already been closed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#receive_data-instance_method" title="#receive_data (instance method)">- (Object) <strong>receive_data</strong>(data) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Called by the event loop whenever data has been received by the network connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reconnect-instance_method" title="#reconnect (instance method)">- (Object) <strong>reconnect</strong>(server, port) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Reconnect to a given host/port with the current instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resume-instance_method" title="#resume (instance method)">- (Object) <strong>resume</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Resume a connection’s <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span> and <span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span> events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_data-instance_method" title="#send_data (instance method)">- (Object) <strong>send_data</strong>(data) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Call this method to send data to the remote end of the network connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_datagram-instance_method" title="#send_datagram (instance method)">- (Object) <strong>send_datagram</strong>(data, recipient_address, recipient_port) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sends UDP messages.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_file_data-instance_method" title="#send_file_data (instance method)">- (Object) <strong>send_file_data</strong>(filename) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Like <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span>, this sends data to the remote end of
the network connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_sock_opt-instance_method" title="#set_sock_opt (instance method)">- (Object) <strong>set_sock_opt</strong>(level, optname, optval) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ssl_handshake_completed-instance_method" title="#ssl_handshake_completed (instance method)">- (Object) <strong>ssl_handshake_completed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Called by EventMachine when the SSL/TLS handshake has
been completed, as a result of calling #start_tls to initiate SSL/TLS on the connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ssl_verify_peer-instance_method" title="#ssl_verify_peer (instance method)">- (Object) <strong>ssl_verify_peer</strong>(cert) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Called by EventMachine when :verify_peer =&gt; true has been passed to <span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_tls-instance_method" title="#start_tls (instance method)">- (Object) <strong>start_tls</strong>(args = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Call <span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span> at any point to initiate TLS encryption on connected streams.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_proxying-instance_method" title="#stop_proxying (instance method)">- (Object) <strong>stop_proxying</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A helper method for <span class='object_link'><a href="../EventMachine.html#disable_proxy-class_method" title="EventMachine.disable_proxy (method)">disable_proxy</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stream_file_data-instance_method" title="#stream_file_data (instance method)">- (EventMachine::Deferrable) <strong>stream_file_data</strong>(filename, args = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Open a file on the filesystem and send it to the remote peer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unbind-instance_method" title="#unbind (instance method)">- (Object) <strong>unbind</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>called by the framework whenever a connection (either a server or client connection) is closed.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="close_connection-instance_method">
  
    - (<tt>Object</tt>) <strong>close_connection</strong>(after_writing = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>EventMachine::Connection#close_connection is called only by user code, and never
by the event loop. You may call this method against a connection object in any
callback handler, whether or not the callback was made against the connection
you want to close. close_connection <i>schedules</i> the connection to be closed
at the next available opportunity within the event loop. You may not assume that
the connection is closed when close_connection returns. In particular, the framework
will callback the unbind method for the particular connection at a point shortly
after you call close_connection. You may assume that the unbind callback will
take place sometime after your call to close_connection completes. In other words,
the unbind callback will not re-enter your code “inside” of your call to close_connection.
However, it’s not guaranteed that a future version of EventMachine will not change
this behavior.</p>

<p><span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span> will <em>silently discard</em> any outbound data which you have
sent to the connection using <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span> but which has not
yet been sent across the network. If you want to avoid this behavior, use
<span class='object_link'><a href="#close_connection_after_writing-instance_method" title="EventMachine::Connection#close_connection_after_writing (method)">#close_connection_after_writing</a></span>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 265</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close_connection'>close_connection</span> <span class='id identifier rubyid_after_writing'>after_writing</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_close_connection'>close_connection</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_after_writing'>after_writing</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close_connection_after_writing-instance_method">
  
    - (<tt>Object</tt>) <strong>close_connection_after_writing</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A variant of <span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span>.
All of the descriptive comments given for close_connection also apply to
close_connection_after_writing, <em>with one exception</em>: if the connection has
outbound data sent using send_dat but which has not yet been sent across the network,
close_connection_after_writing will schedule the connection to be closed <em>after</em>
all of the outbound data has been safely written to the remote peer.</p>

<p>Depending on the amount of outgoing data and the speed of the network,
considerable time may elapse between your call to close_connection_after_writing
and the actual closing of the socket (at which time the unbind callback will be called
by the event loop). During this time, you <em>may not</em> call send_data to transmit
additional data (that is, the connection is closed for further writes). In very
rare cases, you may experience a receive_data callback after your call to <span class='object_link'><a href="#close_connection_after_writing-instance_method" title="EventMachine::Connection#close_connection_after_writing (method)">#close_connection_after_writing</a></span>,
depending on whether incoming data was in the process of being received on the connection
at the moment when you called <span class='object_link'><a href="#close_connection_after_writing-instance_method" title="EventMachine::Connection#close_connection_after_writing (method)">#close_connection_after_writing</a></span>. Your protocol handler must
be prepared to properly deal with such data (probably by ignoring it).</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span></li>
    
      <li><span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


302
303
304</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 302</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close_connection_after_writing'>close_connection_after_writing</span>
  <span class='id identifier rubyid_close_connection'>close_connection</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="comm_inactivity_timeout-instance_method">
  
    - (<tt>Object</tt>) <strong>comm_inactivity_timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>comm_inactivity_timeout returns the current value (float in seconds) of the inactivity-timeout
property of network-connection and datagram-socket objects. A nonzero value
indicates that the connection or socket will automatically be closed if no read or write
activity takes place for at least that number of seconds.
A zero value (the default) specifies that no automatic timeout will take place.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


589
590
591</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 589</span>

<span class='kw'>def</span> <span class='id identifier rubyid_comm_inactivity_timeout'>comm_inactivity_timeout</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_comm_inactivity_timeout'>get_comm_inactivity_timeout</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="comm_inactivity_timeout=-instance_method">
  
    - (<tt>Object</tt>) <strong>comm_inactivity_timeout=</strong>(value) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='set_comm_inactivity_timeout-instance_method'>set_comm_inactivity_timeout</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Allows you to set the inactivity-timeout property for
a network connection or datagram socket. Specify a non-negative float value in seconds.
If the value is greater than zero, the connection or socket will automatically be closed
if no read or write activity takes place for at least that number of seconds.
Specify a value of zero to indicate that no automatic timeout should take place.
Zero is the default value.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


599
600
601</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 599</span>

<span class='kw'>def</span> <span class='id identifier rubyid_comm_inactivity_timeout='>comm_inactivity_timeout=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_set_comm_inactivity_timeout'>set_comm_inactivity_timeout</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connection_completed-instance_method">
  
    - (<tt>Object</tt>) <strong>connection_completed</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Called by the event loop when a remote TCP connection attempt completes successfully.
You can expect to get this notification after calls to <span class='object_link'><a href="../EventMachine.html#connect-class_method" title="EventMachine.connect (method)">EventMachine.connect</a></span>. Remember that EventMachine makes remote connections
asynchronously, just as with any other kind of network event. This method
is intended primarily to assist with network diagnostics. For normal protocol
handling, use #post_init to perform initial work on a new connection (such as sending initial set of data).
<span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span> will always be called. This method will only be called in case of a successful completion.
A connection attempt which fails will result a call to <span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span> after the failure.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span></li>
    
      <li><span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span></li>
    
      <li><a href="../file.GettingStarted.html" title="EventMachine tutorial">EventMachine tutorial</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 362</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connection_completed'>connection_completed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="detach-instance_method">
  
    - (<tt>Object</tt>) <strong>detach</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Removes given connection from the event loop.
The connection’s socket remains open and its file descriptor number is returned.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


271
272
273</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 271</span>

<span class='kw'>def</span> <span class='id identifier rubyid_detach'>detach</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_detach_fd'>detach_fd</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="error?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>error?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns true if the connection is in an error state, false otherwise.</p>

<p>In general, you can detect the occurrence of communication errors or unexpected
disconnection by the remote peer by handing the <span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span> method. In some cases, however,
it’s useful to check the status of the connection using <span class='object_link'><a href="#error%3F-instance_method" title="EventMachine::Connection#error? (method)">#error?</a></span> before attempting to send data.
This function is synchronous but it will return immediately without blocking.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the connection is in an error state, false otherwise</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341
342
343
344
345
346
347
348
349</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 339</span>

<span class='kw'>def</span> <span class='id identifier rubyid_error?'>error?</span>
  <span class='id identifier rubyid_errno'>errno</span> <span class='op'>=</span> <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_report_connection_error_status'>report_connection_error_status</span><span class='lparen'>(</span><span class='ivar'>@signature</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_errno'>errno</span>
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='kw'>false</span>
  <span class='kw'>when</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='const'>EventMachine</span><span class='op'>::</span><span class='const'>ERRNOS</span><span class='lbracket'>[</span><span class='id identifier rubyid_errno'>errno</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_idle_time-instance_method">
  
    - (<tt>Object</tt>) <strong>get_idle_time</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The number of seconds since the last send/receive activity on this connection.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


580
581
582</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 580</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_idle_time'>get_idle_time</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_idle_time'>get_idle_time</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_peer_cert-instance_method">
  
    - (<tt>String</tt>) <strong>get_peer_cert</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>If <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> is active on the connection, returns the remote <a href="http://en.wikipedia.org/wiki/X.509">X509 certificate</a>
as a string, in the popular <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM format</a>. This can then be used for arbitrary validation
of a peer’s certificate in your code.</p>

<p>This should be called in/after the <span class='object_link'><a href="#ssl_handshake_completed-instance_method" title="EventMachine::Connection#ssl_handshake_completed (method)">#ssl_handshake_completed</a></span> callback, which indicates
that SSL/TLS is active. Using this callback is important, because the certificate may not
be available until the time it is executed. Using #post_init or #connection_completed is
not adequate, because the SSL handshake may still be taking place.</p>

<p>This method will return <code>nil</code> if:</p>

<ul>
  <li>EventMachine is not built with <a href="http://www.openssl.org">OpenSSL</a> support</li>
  <li><a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> is not active on the connection</li>
  <li>TLS handshake is not yet complete</li>
  <li>Remote peer for any other reason has not presented a certificate</li>
</ul>

<p>You can do whatever you want with the certificate String, such as load it
as a certificate object using the OpenSSL library, and check its fields.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Getting peer TLS certificate information in EventMachine</p>
</div></p>
      
      <pre class="example code"><code>
<span class='kw'>module</span> <span class='const'>Handler</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_post_init'>post_init</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting TLS</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_start_tls'>start_tls</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_ssl_handshake_completed'>ssl_handshake_completed</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_get_peer_cert'>get_peer_cert</span>
    <span class='id identifier rubyid_close_connection'>close_connection</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unbind'>unbind</span>
    <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_stop_event_loop'>stop_event_loop</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

 <span class='const'>EventMachine</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
   <span class='const'>EventMachine</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mail.google.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>443</span><span class='comma'>,</span> <span class='const'>Handler</span>
<span class='kw'>end</span>

<span class='comment'># Will output:
</span><span class='comment'># -----BEGIN CERTIFICATE-----
</span><span class='comment'># MIIDIjCCAougAwIBAgIQbldpChBPqv+BdPg4iwgN8TANBgkqhkiG9w0BAQUFADBM
</span><span class='comment'># MQswCQYDVQQGEwJaQTElMCMGA1UEChMcVGhhd3RlIENvbnN1bHRpbmcgKFB0eSkg
</span><span class='comment'># THRkLjEWMBQGA1UEAxMNVGhhd3RlIFNHQyBDQTAeFw0wODA1MDIxNjMyNTRaFw0w
</span><span class='comment'># OTA1MDIxNjMyNTRaMGkxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlh
</span><span class='comment'># MRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRMwEQYDVQQKEwpHb29nbGUgSW5jMRgw
</span><span class='comment'># FgYDVQQDEw9tYWlsLmdvb2dsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJ
</span><span class='comment'># AoGBALlkxdh2QXegdElukCSOV2+8PKiONIS+8Tu9K7MQsYpqtLNC860zwOPQ2NLI
</span><span class='comment'># 3Zp4jwuXVTrtzGuiqf5Jioh35Ig3CqDXtLyZoypjZUQcq4mlLzHlhIQ4EhSjDmA7
</span><span class='comment'># Ffw9y3ckSOQgdBQWNLbquHh9AbEUjmhkrYxIqKXeCnRKhv6nAgMBAAGjgecwgeQw
</span><span class='comment'># KAYDVR0lBCEwHwYIKwYBBQUHAwEGCCsGAQUFBwMCBglghkgBhvhCBAEwNgYDVR0f
</span><span class='comment'># BC8wLTAroCmgJ4YlaHR0cDovL2NybC50aGF3dGUuY29tL1RoYXd0ZVNHQ0NBLmNy
</span><span class='comment'># bDByBggrBgEFBQcBAQRmMGQwIgYIKwYBBQUHMAGGFmh0dHA6Ly9vY3NwLnRoYXd0
</span><span class='comment'># ZS5jb20wPgYIKwYBBQUHMAKGMmh0dHA6Ly93d3cudGhhd3RlLmNvbS9yZXBvc2l0
</span><span class='comment'># b3J5L1RoYXd0ZV9TR0NfQ0EuY3J0MAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEF
</span><span class='comment'># BQADgYEAsRwpLg1dgCR1gYDK185MFGukXMeQFUvhGqF8eT/CjpdvezyKVuz84gSu
</span><span class='comment'># 6ccMXgcPQZGQN/F4Xug+Q01eccJjRSVfdvR5qwpqCj+6BFl5oiKDBsveSkrmL5dz
</span><span class='comment'># s2bn7TdTSYKcLeBkjXxDLHGBqLJ6TNCJ3c4/cbbG5JhGvoema94=
</span><span class='comment'># -----END CERTIFICATE-----</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the remote <a href="http://en.wikipedia.org/wiki/X.509">X509 certificate</a>, in the popular <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM format</a>,
if TLS is active on the connection</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span></li>
    
      <li><span class='object_link'><a href="#ssl_handshake_completed-instance_method" title="EventMachine::Connection#ssl_handshake_completed (method)">#ssl_handshake_completed</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


487
488
489</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 487</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_peer_cert'>get_peer_cert</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_peer_cert'>get_peer_cert</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_peername-instance_method">
  
    - (<tt>Object</tt>) <strong>get_peername</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>This method is used with stream-connections to obtain the identity
of the remotely-connected peer. If a peername is available, this method
returns a sockaddr structure. The method returns nil if no peername is available.
You can use Socket.unpack_sockaddr_in and its variants to obtain the
values contained in the peername structure returned from #get_peername.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>How to get peer IP address and port with EventMachine</p>
</div></p>
      
      <pre class="example code"><code>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>module</span> <span class='const'>Handler</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_receive_data'>receive_data</span> <span class='id identifier rubyid_data'>data</span>
    <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_unpack_sockaddr_in'>unpack_sockaddr_in</span><span class='lparen'>(</span><span class='id identifier rubyid_get_peername'>get_peername</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


538
539
540</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 538</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_peername'>get_peername</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_peername'>get_peername</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pid-instance_method">
  
    - (<tt>Integer</tt>) <strong>get_pid</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the PID (kernel process identifier) of a subprocess
associated with this Connection object. For use with <span class='object_link'><a href="../EventMachine.html#popen-class_method" title="EventMachine.popen (method)">EventMachine.popen</a></span>
and similar methods. Returns nil when there is no meaningful subprocess.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


567
568
569</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 567</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pid'>get_pid</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_subprocess_pid'>get_subprocess_pid</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_proxied_bytes-instance_method">
  
    - (<tt>Object</tt>) <strong>get_proxied_bytes</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The number of bytes proxied to another connection. Reset to zero when
EventMachine::Connection#proxy_incoming_to is called, and incremented whenever data is proxied.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


243
244
245</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 243</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_proxied_bytes'>get_proxied_bytes</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_proxied_bytes'>get_proxied_bytes</span><span class='lparen'>(</span><span class='ivar'>@signature</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_sock_opt-instance_method">
  
    - (<tt>Object</tt>) <strong>get_sock_opt</strong>(level, option) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 275</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_sock_opt'>get_sock_opt</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='id identifier rubyid_option'>option</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_sock_opt'>get_sock_opt</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='id identifier rubyid_option'>option</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_sockname-instance_method">
  
    - (<tt>Object</tt>) <strong>get_sockname</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Used with stream-connections to obtain the identity
of the local side of the connection. If a local name is available, this method
returns a sockaddr structure. The method returns nil if no local name is available.
You can use Socket.unpack_sockaddr_in and its variants to obtain the
values contained in the local-name structure returned from this method.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>module</span> <span class='const'>Handler</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_receive_data'>receive_data</span> <span class='id identifier rubyid_data'>data</span>
    <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_ip'>ip</span> <span class='op'>=</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_unpack_sockaddr_in'>unpack_sockaddr_in</span><span class='lparen'>(</span><span class='id identifier rubyid_get_sockname'>get_sockname</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


558
559
560</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 558</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_sockname'>get_sockname</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_sockname'>get_sockname</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status-instance_method">
  
    - (<tt>Integer</tt>) <strong>get_status</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a subprocess exit status. Only useful for <span class='object_link'><a href="../EventMachine.html#popen-class_method" title="EventMachine.popen (method)">EventMachine.popen</a></span>. Call it in your
<span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span> handler.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


575
576
577</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 575</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_status'>get_status</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_subprocess_status'>get_subprocess_status</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notify_readable=-instance_method">
  
    - (<tt>Object</tt>) <strong>notify_readable=</strong>(mode) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Watches connection for readability. Only possible if the connection was created
using <span class='object_link'><a href="../EventMachine.html#attach-class_method" title="EventMachine.attach (method)">EventMachine.attach</a></span> and had EventMachine.notify_readable/EventMachine.notify_writable defined on the handler.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#notify_readable%3F-instance_method" title="EventMachine::Connection#notify_readable? (method)">#notify_readable?</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


671
672
673</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 671</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_readable='>notify_readable=</span> <span class='id identifier rubyid_mode'>mode</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_set_notify_readable'>set_notify_readable</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notify_readable?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>notify_readable?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>True if the connection is being watched for readability.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the connection is being watched for readability.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


676
677
678</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 676</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_readable?'>notify_readable?</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_is_notify_readable'>is_notify_readable</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notify_writable=-instance_method">
  
    - (<tt>Object</tt>) <strong>notify_writable=</strong>(mode) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Watches connection for writeability. Only possible if the connection was created
using <span class='object_link'><a href="../EventMachine.html#attach-class_method" title="EventMachine.attach (method)">EventMachine.attach</a></span> and had EventMachine.notify_readable/EventMachine.notify_writable defined on the handler.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#notify_writable%3F-instance_method" title="EventMachine::Connection#notify_writable? (method)">#notify_writable?</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


684
685
686</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 684</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_writable='>notify_writable=</span> <span class='id identifier rubyid_mode'>mode</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_set_notify_writable'>set_notify_writable</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notify_writable?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>notify_writable?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns true if the connection is being watched for writability.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


689
690
691</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 689</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_writable?'>notify_writable?</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_is_notify_writable'>is_notify_writable</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pause-instance_method">
  
    - (<tt>Object</tt>) <strong>pause</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Pause a connection so that <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span> and <span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span> events are not fired until <span class='object_link'><a href="#resume-instance_method" title="EventMachine::Connection#resume (method)">#resume</a></span> is called.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#resume-instance_method" title="EventMachine::Connection#resume (method)">#resume</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


695
696
697</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 695</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pause'>pause</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_pause_connection'>pause_connection</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="paused?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>paused?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>True if the connect was paused using <span class='object_link'><a href="#pause-instance_method" title="EventMachine::Connection#pause (method)">#pause</a></span>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the connect was paused using <span class='object_link'><a href="#pause-instance_method" title="EventMachine::Connection#pause (method)">#pause</a></span>.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#pause-instance_method" title="EventMachine::Connection#pause (method)">#pause</a></span></li>
    
      <li><span class='object_link'><a href="#resume-instance_method" title="EventMachine::Connection#resume (method)">#resume</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


708
709
710</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 708</span>

<span class='kw'>def</span> <span class='id identifier rubyid_paused?'>paused?</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_connection_paused?'>connection_paused?</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending_connect_timeout-instance_method">
  
    - (<tt>Float</tt>) <strong>pending_connect_timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The duration after which a TCP connection in the connecting state will fail.
It is important to distinguish this value from <span class='object_link'><a href="#comm_inactivity_timeout-instance_method" title="EventMachine::Connection#comm_inactivity_timeout (method)">#comm_inactivity_timeout</a></span>,
which looks at how long since data was passed on an already established connection.
The value is a float in seconds.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The duration after which a TCP connection in the connecting state will fail, in seconds.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


610
611
612</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 610</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending_connect_timeout'>pending_connect_timeout</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_get_pending_connect_timeout'>get_pending_connect_timeout</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending_connect_timeout=-instance_method">
  
    - (<tt>Object</tt>) <strong>pending_connect_timeout=</strong>(value) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='set_pending_connect_timeout-instance_method'>set_pending_connect_timeout</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Sets the duration after which a TCP connection in a
connecting state will fail.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Float</tt>, <tt>#to_f</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Connection timeout in seconds</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


618
619
620</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 618</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending_connect_timeout='>pending_connect_timeout=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_set_pending_connect_timeout'>set_pending_connect_timeout</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_init-instance_method">
  
    - (<tt>Object</tt>) <strong>post_init</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Called by the event loop immediately after the network connection has been established,
and before resumption of the network loop.
This method is generally not called by user code, but is called automatically
by the event loop. The base-class implementation is a no-op.
This is a very good place to initialize instance variables that will
be used throughout the lifetime of the network connection.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span></li>
    
      <li><span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span></li>
    
      <li><span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span></li>
    
      <li><span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_post_init'>post_init</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="proxy_completed-instance_method">
  
    - (<tt>Object</tt>) <strong>proxy_completed</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>called when the reactor finished proxying all
of the requested bytes.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_proxy_completed'>proxy_completed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="proxy_incoming_to-instance_method">
  
    - (<tt>Object</tt>) <strong>proxy_incoming_to</strong>(conn, bufsize = 0) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>EventMachine::Connection#proxy_incoming_to is called only by user code. It sets up
a low-level proxy relay for all data inbound for this connection, to the connection given
as the argument. This is essentially just a helper method for enable_proxy.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="../EventMachine.html#enable_proxy-class_method" title="EventMachine.enable_proxy (method)">EventMachine.enable_proxy</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


232
233
234</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 232</span>

<span class='kw'>def</span> <span class='id identifier rubyid_proxy_incoming_to'>proxy_incoming_to</span><span class='lparen'>(</span><span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span><span class='id identifier rubyid_bufsize'>bufsize</span><span class='op'>=</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_enable_proxy'>enable_proxy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span> <span class='id identifier rubyid_bufsize'>bufsize</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="proxy_target_unbound-instance_method">
  
    - (<tt>Object</tt>) <strong>proxy_target_unbound</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Called by the reactor after attempting to relay incoming data to a descriptor (set as a proxy target descriptor with
<span class='object_link'><a href="../EventMachine.html#enable_proxy-class_method" title="EventMachine.enable_proxy (method)">EventMachine.enable_proxy</a></span>) that has already been closed.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="../EventMachine.html#enable_proxy-class_method" title="EventMachine.enable_proxy (method)">EventMachine.enable_proxy</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 219</span>

<span class='kw'>def</span> <span class='id identifier rubyid_proxy_target_unbound'>proxy_target_unbound</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="receive_data-instance_method">
  
    - (<tt>Object</tt>) <strong>receive_data</strong>(data) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Depending on the protocol, buffer sizes and OS networking stack configuration, incoming data may or may not be &#8220;a complete message&#8221;.
It is up to this handler to detect content boundaries to determine whether all the content (for example, full HTTP request)
has been received and can be processed.</p>
</div>
  </div>

<p>Called by the event loop whenever data has been received by the network connection.
It is never called by user code. <span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span> is called with a single parameter, a String containing
the network protocol data, which may of course be binary. You will
generally redefine this method to perform your own processing of the incoming data.</p>

<p>Here’s a key point which is essential to understanding the event-driven
programming model: <i>EventMachine knows absolutely nothing about the protocol
which your code implements.</i> You must not make any assumptions about
the size of the incoming data packets, or about their alignment on any
particular intra-message or PDU boundaries (such as line breaks).
receive_data can and will send you arbitrary chunks of data, with the
only guarantee being that the data is presented to your code in the order
it was collected from the network. Don’t even assume that the chunks of
data will correspond to network packets, as EventMachine can and will coalesce
several incoming packets into one, to improve performance. The implication for your
code is that you generally will need to implement some kind of a state machine
in your redefined implementation of receive_data. For a better understanding
of this, read through the examples of specific protocol handlers in EventMachine::Protocols</p>

<p>The base-class implementation (which will be invoked only if you didn’t override it in your protocol handler)
simply prints incoming data packet size to stdout.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Opaque incoming data.</p>
</div>
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span></li>
    
      <li><span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span></li>
    
      <li><span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span></li>
    
      <li><span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span></li>
    
      <li><a href="../file.GettingStarted.html" title="EventMachine tutorial">EventMachine tutorial</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_data'>receive_data</span> <span class='id identifier rubyid_data'>data</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>............&gt;&gt;&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reconnect-instance_method">
  
    - (<tt>Object</tt>) <strong>reconnect</strong>(server, port) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Reconnect to a given host/port with the current instance</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Hostname or IP address</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>port</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Port to reconnect to</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


627
628
629</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 627</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reconnect'>reconnect</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_reconnect'>reconnect</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resume-instance_method">
  
    - (<tt>Object</tt>) <strong>resume</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Resume a connection’s <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span> and <span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span> events.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#pause-instance_method" title="EventMachine::Connection#pause (method)">#pause</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


701
702
703</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 701</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resume'>resume</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_resume_connection'>resume_connection</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_data-instance_method">
  
    - (<tt>Object</tt>) <strong>send_data</strong>(data) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Call this method to send data to the remote end of the network connection. It takes a single String argument,
which may contain binary data. Data is buffered to be sent at the end of this event loop tick (cycle).</p>

<p>When used in a method that is event handler (for example, <span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span> or <span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span>, it will send
data to the other end of the connection that generated the event.
You can also call <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span> to write to other connections. For more information see The Chat Server Example in the
<a href="../file.GettingStarted.html" title="EventMachine tutorial">EventMachine tutorial</a>.</p>

<p>If you want to send some data and then immediately close the connection, make sure to use <span class='object_link'><a href="#close_connection_after_writing-instance_method" title="EventMachine::Connection#close_connection_after_writing (method)">#close_connection_after_writing</a></span>
instead of <span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Data to send asynchronously</p>
</div>
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="../file.GettingStarted.html" title="EventMachine tutorial">EventMachine tutorial</a></li>
    
      <li><span class='object_link'><a href="#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></span></li>
    
      <li><span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span></li>
    
      <li><span class='object_link'><a href="#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326
327
328
329</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_data'>data</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:bytesize</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>||=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_send_data'>send_data</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_datagram-instance_method">
  
    - (<tt>Object</tt>) <strong>send_datagram</strong>(data, recipient_address, recipient_port) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Sends UDP messages.</p>

<p>This method may be called from any Connection object that refers
to an open datagram socket (see EventMachine#open_datagram_socket).
The method sends a UDP (datagram) packet containing the data you specify,
to a remote peer specified by the IP address and port that you give
as parameters to the method.
Observe that you may send a zero-length packet (empty string).
However, you may not send an arbitrarily-large data packet because
your operating system will enforce a platform-specific limit on
the size of the outbound packet. (Your kernel
will respond in a platform-specific way if you send an overlarge
packet: some will send a truncated packet, some will complain, and
some will silently drop your request).
On LANs, it’s usually OK to send datagrams up to about 4000 bytes in length,
but to be really safe, send messages smaller than the Ethernet-packet
size (typically about 1400 bytes). Some very restrictive WANs
will either drop or truncate packets larger than about 500 bytes.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Data to send asynchronously</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>recipient_address</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>IP address of the recipient</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>recipient_port</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Port of the recipient</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


514
515
516
517
518
519</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 514</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_datagram'>send_datagram</span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_recipient_address'>recipient_address</span><span class='comma'>,</span> <span class='id identifier rubyid_recipient_port'>recipient_port</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:bytesize</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>||=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_send_datagram'>send_datagram</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_recipient_address'>recipient_address</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_recipient_port'>recipient_port</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_file_data-instance_method">
  
    - (<tt>Object</tt>) <strong>send_file_data</strong>(filename) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Like <span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span>, this sends data to the remote end of
the network connection. <span class='object_link'><a href="#send_file_data-instance_method" title="EventMachine::Connection#send_file_data (method)">#send_file_data</a></span> takes a
filename as an argument, though, and sends the contents of the file, in one
chunk.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Local path of the file to send</p>
</div>
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></span></li>
    
  </ul>
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Kirk Haines</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


641
642
643</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 641</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_file_data'>send_file_data</span> <span class='id identifier rubyid_filename'>filename</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_send_file_data'>send_file_data</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_sock_opt-instance_method">
  
    - (<tt>Object</tt>) <strong>set_sock_opt</strong>(level, optname, optval) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


279
280
281</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 279</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_sock_opt'>set_sock_opt</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='id identifier rubyid_optname'>optname</span><span class='comma'>,</span> <span class='id identifier rubyid_optval'>optval</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_set_sock_opt'>set_sock_opt</span> <span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='id identifier rubyid_optname'>optname</span><span class='comma'>,</span> <span class='id identifier rubyid_optval'>optval</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ssl_handshake_completed-instance_method">
  
    - (<tt>Object</tt>) <strong>ssl_handshake_completed</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Called by EventMachine when the SSL/TLS handshake has
been completed, as a result of calling #start_tls to initiate SSL/TLS on the connection.</p>

<p>This callback exists because <span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span> and <span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span> are <strong>not</strong> reliable
for indicating when an SSL/TLS connection is ready to have its certificate queried for.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#get_peer_cert-instance_method" title="EventMachine::Connection#get_peer_cert (method)">#get_peer_cert</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ssl_handshake_completed'>ssl_handshake_completed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ssl_verify_peer-instance_method">
  
    - (<tt>Object</tt>) <strong>ssl_verify_peer</strong>(cert) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Called by EventMachine when :verify_peer =&gt; true has been passed to <span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span>.
It will be called with each certificate in the certificate chain provided by the remote peer.</p>

<p>The cert will be passed as a String in PEM format, the same as in <span class='object_link'><a href="#get_peer_cert-instance_method" title="EventMachine::Connection#get_peer_cert (method)">#get_peer_cert</a></span>. It is up to user defined
code to perform a check on the certificates. The return value from this callback is used to accept or deny the peer.
A return value that is not nil or false triggers acceptance. If the peer is not accepted, the connection
will be subsequently closed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>This server always accepts all peers</p>
</div></p>
      
      <pre class="example code"><code>
<span class='kw'>module</span> <span class='const'>AcceptServer</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_post_init'>post_init</span>
    <span class='id identifier rubyid_start_tls'>start_tls</span><span class='lparen'>(</span><span class='symbol'>:verify_peer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_ssl_verify_peer'>ssl_verify_peer</span><span class='lparen'>(</span><span class='id identifier rubyid_cert'>cert</span><span class='rparen'>)</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_ssl_handshake_completed'>ssl_handshake_completed</span>
    <span class='gvar'>$server_handshake_completed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>This server never accepts any peers</p>
</div></p>
      
      <pre class="example code"><code>
<span class='kw'>module</span> <span class='const'>DenyServer</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_post_init'>post_init</span>
    <span class='id identifier rubyid_start_tls'>start_tls</span><span class='lparen'>(</span><span class='symbol'>:verify_peer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_ssl_verify_peer'>ssl_verify_peer</span><span class='lparen'>(</span><span class='id identifier rubyid_cert'>cert</span><span class='rparen'>)</span>
    <span class='comment'># Do not accept the peer. This should now cause the connection to shut down
</span>    <span class='comment'># without the SSL handshake being completed.
</span>    <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_ssl_handshake_completed'>ssl_handshake_completed</span>
    <span class='gvar'>$server_handshake_completed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ssl_verify_peer'>ssl_verify_peer</span><span class='lparen'>(</span><span class='id identifier rubyid_cert'>cert</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_tls-instance_method">
  
    - (<tt>Object</tt>) <strong>start_tls</strong>(args = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>support passing an encryption parameter, which can be string or Proc, to get a passphrase</p>
</div>
  </div>

  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>support passing key material via raw strings or Procs that return strings instead of</p>
</div>
  </div>

<p>Call <span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span> at any point to initiate TLS encryption on connected streams.
The method is smart enough to know whether it should perform a server-side
or a client-side handshake. An appropriate place to call <span class='object_link'><a href="#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></span> is in
your redefined <span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span> method, or in the <span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span> handler for
an outbound connection.</p>

<p>for encrypted private keys.
just filenames.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Using TLS with EventMachine</p>
</div></p>
      
      <pre class="example code"><code>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubygems</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>eventmachine</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>module</span> <span class='const'>Handler</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_post_init'>post_init</span>
    <span class='id identifier rubyid_start_tls'>start_tls</span><span class='lparen'>(</span><span class='symbol'>:private_key_file</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tmp/server.key</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:cert_chain_file</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/tmp/server.crt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:verify_peer</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

 <span class='const'>EventMachine</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='const'>EventMachine</span><span class='period'>.</span><span class='id identifier rubyid_start_server'>start_server</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>9999</span><span class='comma'>,</span> <span class='const'>Handler</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>args</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:cert_chain_file</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>local path of a readable file that contants  a chain of X509 certificates in
the <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM format</a>,
with the most-resolved certificate at the top of the file, successive intermediate
certs in the middle, and the root (or CA) cert at the bottom.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:private_key_file</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>local path of a readable file that must contain a private key in the <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM format</a>.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:verify_peer</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>indicates whether a server should request a certificate from a peer, to be verified by user code.
If true, the <span class='object_link'><a href="#ssl_verify_peer-instance_method" title="EventMachine::Connection#ssl_verify_peer (method)">#ssl_verify_peer</a></span> callback on the <span class='object_link'><a href="" title="EventMachine::Connection (class)">EventMachine::Connection</a></span> object is called with each certificate
in the certificate chain provided by the peer. See documentation on <span class='object_link'><a href="#ssl_verify_peer-instance_method" title="EventMachine::Connection#ssl_verify_peer (method)">#ssl_verify_peer</a></span> for how to use this.</p>
</div>
          
        </li>
      
    </ul>
  


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#ssl_verify_peer-instance_method" title="EventMachine::Connection#ssl_verify_peer (method)">#ssl_verify_peer</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


406
407
408
409
410
411
412
413
414
415
416
417</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 406</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_tls'>start_tls</span> <span class='id identifier rubyid_args'>args</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_priv_key'>priv_key</span><span class='comma'>,</span> <span class='id identifier rubyid_cert_chain'>cert_chain</span><span class='comma'>,</span> <span class='id identifier rubyid_verify_peer'>verify_peer</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='symbol'>:private_key_file</span><span class='comma'>,</span> <span class='symbol'>:cert_chain_file</span><span class='comma'>,</span> <span class='symbol'>:verify_peer</span><span class='rparen'>)</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_priv_key'>priv_key</span><span class='comma'>,</span> <span class='id identifier rubyid_cert_chain'>cert_chain</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FileNotFoundException</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not find </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='embexpr_end'>}</span><span class='tstring_content'> for start_tls</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span> <span class='id identifier rubyid_file'>file</span>
  <span class='kw'>end</span>

  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_set_tls_parms'>set_tls_parms</span><span class='lparen'>(</span><span class='ivar'>@signature</span><span class='comma'>,</span> <span class='id identifier rubyid_priv_key'>priv_key</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_cert_chain'>cert_chain</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_verify_peer'>verify_peer</span><span class='rparen'>)</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_start_tls'>start_tls</span> <span class='ivar'>@signature</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_proxying-instance_method">
  
    - (<tt>Object</tt>) <strong>stop_proxying</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A helper method for <span class='object_link'><a href="../EventMachine.html#disable_proxy-class_method" title="EventMachine.disable_proxy (method)">EventMachine.disable_proxy</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


237
238
239</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 237</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_proxying'>stop_proxying</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='id identifier rubyid_disable_proxy'>disable_proxy</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stream_file_data-instance_method">
  
    - (<tt><span class='object_link'><a href="Deferrable.html" title="EventMachine::Deferrable (module)">EventMachine::Deferrable</a></span></tt>) <strong>stream_file_data</strong>(filename, args = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Open a file on the filesystem and send it to the remote peer. This returns an
object of type <span class='object_link'><a href="Deferrable.html" title="EventMachine::Deferrable (module)">Deferrable</a></span>. The object’s callbacks will be executed
on the reactor main thread when the file has been completely scheduled for
transmission to the remote peer. Its errbacks will be called in case of an error (such as file-not-found).
This method employs various strategies to achieve the fastest possible performance,
balanced against minimum consumption of memory.</p>

<p>Warning: this feature has an implicit dependency on an outboard extension,
evma_fastfilereader. You must install this extension in order to use <span class='object_link'><a href="#stream_file_data-instance_method" title="EventMachine::Connection#stream_file_data (method)">#stream_file_data</a></span>
with files larger than a certain size (currently 8192 bytes).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Local path of the file to stream</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>args</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:http_chunks</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>If true, this method will stream the file data in a format
compatible with the HTTP chunked-transfer encoding</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Deferrable.html" title="EventMachine::Deferrable (module)">EventMachine::Deferrable</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


663
664
665</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 663</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stream_file_data'>stream_file_data</span> <span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'>EventMachine</span><span class='op'>::</span><span class='const'>FileStreamer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unbind-instance_method">
  
    - (<tt>Object</tt>) <strong>unbind</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>called by the framework whenever a connection (either a server or client connection) is closed.
The close can occur because your code intentionally closes it (using <span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span> and <span class='object_link'><a href="#close_connection_after_writing-instance_method" title="EventMachine::Connection#close_connection_after_writing (method)">#close_connection_after_writing</a></span>),
because the remote peer closed the connection, or because of a network error.
You may not assume that the network connection is still open and able to send or
receive data when the callback to unbind is made. This is intended only to give
you a chance to clean up associations your code may have made to the connection
object while it was open.</p>

<p>If you want to detect which peer has closed the connection, you can override <span class='object_link'><a href="#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></span> in your protocol handler
and set an @ivar.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Overriding Connection#close_connection to distinguish connections closed on our side</p>
</div></p>
      
      <pre class="example code"><code>
<span class='kw'>class</span> <span class='const'>MyProtocolHandler</span> <span class='op'>&lt;</span> <span class='const'>EventMachine</span><span class='op'>::</span><span class='const'>Connection</span>

  <span class='comment'># ...
</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_close_connection'>close_connection</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='ivar'>@intentionally_closed_connection</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unbind'>unbind</span>
    <span class='kw'>if</span> <span class='ivar'>@intentionally_closed_connection</span>
      <span class='comment'># ...
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># ...
</span>
<span class='kw'>end</span></code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></span></li>
    
      <li><span class='object_link'><a href="#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></span></li>
    
      <li><a href="../file.GettingStarted.html" title="EventMachine tutorial">EventMachine tutorial</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/em/connection.rb', line 212</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unbind'>unbind</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Feb 21 19:35:00 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-2.0.0).
</div>

  </body>
</html>