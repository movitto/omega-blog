<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Manufactured::MiningCommand
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Manufactured.html" title="Manufactured (module)">Manufactured</a></span></span>
     &raquo; 
    <span class="title">MiningCommand</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Manufactured::MiningCommand
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Manufactured::MiningCommand</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/manufactured/commands.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Represents action of one <span class='object_link'><a href="Ship.html" title="Manufactured::Ship (class)">Ship</a></span> mining a
<span class='object_link'><a href="../Cosmos/ResourceSource.html" title="Cosmos::ResourceSource (class)">Cosmos::ResourceSource</a></span></p>

<p>Registered with the registry by a client when miner commences miner and
periodically run by registry until mining stops, as the result of one of
conditions occurring</p>

<p>Invokes various Manufactured::Callback handlers upon various events.</p>


  </div>
</div>
<div class="tags">
  

</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#hooks-instance_method" title="#hooks (instance method)">- (Object) <strong>hooks</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Hash of command sequence events to callbale handlers to invoke on those
events.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_time_mined-instance_method" title="#last_time_mined (instance method)">- (Object) <strong>last_time_mined</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Time of last time <span class='object_link'><a href="#mine%21-instance_method" title="Manufactured::MiningCommand#mine! (method)">#mine!</a></span> was invoked.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#resource_source-instance_method" title="#resource_source (instance method)">- (Object) <strong>resource_source</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><span class='object_link'><a href="../Cosmos/ResourceSource.html" title="Cosmos::ResourceSource (class)">Cosmos::ResourceSource</a></span> being mined.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ship-instance_method" title="#ship (instance method)">- (Object) <strong>ship</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Mining <span class='object_link'><a href="Ship.html" title="Manufactured::Ship (class)">ship</a></span>.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#id-instance_method" title="#id (instance method)">- (Object) <strong>id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return the unique id of this mining command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (MiningCommand) <strong>initialize</strong>(args = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Manufactured::MiningCommand initializer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#minable%3F-instance_method" title="#minable? (instance method)">- (true, false) <strong>minable?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns boolean indicating if mine! can / should be called.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mine%21-instance_method" title="#mine! (instance method)">- (Object) <strong>mine!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Ensure mining command is still valid and perform one mining cycle.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove%3F-instance_method" title="#remove? (instance method)">- (true, false) <strong>remove?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns boolean indicating if this mining command should be removed.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Manufactured::MiningCommand (class)">MiningCommand</a></span></tt>) <strong>initialize</strong>(args = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Manufactured::MiningCommand initializer</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>hash of options to initialize mining command with</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>args</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:ship</span>
          <span class="type">(<tt><span class='object_link'><a href="Ship.html" title="Manufactured::Ship (class)">Manufactured::Ship</a></span></tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'>
<p>miner ship</p>
</div>
        </li>
      
        <li>
          <span class="name">:resource_source</span>
          <span class="type">(<tt><span class='object_link'><a href="../Cosmos/ResourceSource.html" title="Cosmos::ResourceSource (class)">Cosmos::ResourceSource</a></span></tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'>
<p>resource source being mined</p>
</div>
        </li>
      
        <li>
          <span class="name">:before</span>
          <span class="type">(<tt>Callable</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'>
<p>callable object to register with the 'before' hooks</p>
</div>
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 196</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@ship</span>            <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:ship</span><span class='rbracket'>]</span>
  <span class='ivar'>@resource_source</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:resource_source</span><span class='rbracket'>]</span>
  <span class='ivar'>@remove</span>          <span class='op'>=</span> <span class='kw'>false</span>

  <span class='ivar'>@hooks</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:before</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='ivar'>@hooks</span><span class='lbracket'>[</span><span class='symbol'>:before</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='symbol'>:before</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:before</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="hooks=-instance_method"></span>
      <span id="hooks-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="hooks-instance_method">
  
    - (<tt>Object</tt>) <strong>hooks</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Hash of command sequence events to callbale handlers to invoke on those
events. Valid values for keys include: :before</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hooks'>hooks</span>
  <span class='ivar'>@hooks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="last_time_mined=-instance_method"></span>
      <span id="last_time_mined-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="last_time_mined-instance_method">
  
    - (<tt>Object</tt>) <strong>last_time_mined</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Time of last time <span class='object_link'><a href="#mine%21-instance_method" title="Manufactured::MiningCommand#mine! (method)">#mine!</a></span> was invoked</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last_time_mined'>last_time_mined</span>
  <span class='ivar'>@last_time_mined</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="resource_source=-instance_method"></span>
      <span id="resource_source-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="resource_source-instance_method">
  
    - (<tt>Object</tt>) <strong>resource_source</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p><span class='object_link'><a href="../Cosmos/ResourceSource.html" title="Cosmos::ResourceSource (class)">Cosmos::ResourceSource</a></span> being mined</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resource_source'>resource_source</span>
  <span class='ivar'>@resource_source</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="ship=-instance_method"></span>
      <span id="ship-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="ship-instance_method">
  
    - (<tt>Object</tt>) <strong>ship</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Mining <span class='object_link'><a href="Ship.html" title="Manufactured::Ship (class)">ship</a></span></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 179</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ship'>ship</span>
  <span class='ivar'>@ship</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="id-instance_method">
  
    - (<tt>Object</tt>) <strong>id</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Return the unique id of this mining command.</p>

<p>Checked by the registry to ensure no two commands correspond to the same
operation. Currently returns miner id indicating a ship may only mine one
source at a time, at some point we may want to incorporate multiple
resources into this (TODO)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_id'>id</span>
  <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="minable?-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>minable?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Returns boolean indicating if mine! can / should be called.</p>

<p>Determines if enough time has lapsed since the last mining operation to
compensate for the miners's mining rate</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>indicating if mining! can / cannot be called</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 219</span>

<span class='kw'>def</span> <span class='id identifier rubyid_minable?'>minable?</span>
  <span class='comment'># elapsed time between mining cycles is less than ship's mining rate
</span>  <span class='kw'>return</span> <span class='ivar'>@last_time_mined</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@last_time_mined</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>/</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_mining_rate'>mining_rate</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="mine!-instance_method">
  
    - (<tt>Object</tt>) <strong>mine!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Ensure mining command is still valid and perform one mining cycle.</p>

<p>This method ensures the mining would still be valid (miner/resource are
close enough, etc) and then launches the operation.</p>

<p>Also invokes <span class='object_link'><a href="Callback.html" title="Manufactured::Callback (class)">Callback</a></span>s registered with the miner 
before/during/after the mining cycle with the event type, and various other
parameters</p>

<p>The callback events/types invoked include:</p>
<ul><li>
<p>'resource_depeleted' - invoked when resource source quantity becomes &lt;=
0 with event, miner, and resource source as params</p>
</li><li>
<p>'mining_stopped'     - invoked when miner stops mining with event, stopped
reason, ship, and resource source as params. Reasons include:</p>
</li></ul>

<p>** 'mining_distance_exceeded' ** 'ship_cargo_full' ** 'ship_docked' **
'resource_depleted' (also invokes 'resource_depeleted' callback)</p>
<ul><li>
<p>'resource_collected' - invoked when miner collects the resource from the
source, with event, miner, resource source, and quantity mined during this
operation as params</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 241</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mine!'>mine!</span>
  <span class='const'>RJR</span><span class='op'>::</span><span class='const'>Logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invoking mining command </span><span class='embexpr_beg'>#{</span><span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'> -&gt; </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># if resource_source has less than mining_quantity only transfer that amount
</span>  <span class='id identifier rubyid_mining_quantity'>mining_quantity</span> <span class='op'>=</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_mining_quantity'>mining_quantity</span>
  <span class='id identifier rubyid_mining_quantity'>mining_quantity</span> <span class='op'>=</span> <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_quantity'>quantity</span> <span class='kw'>if</span> <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_mining_quantity'>mining_quantity</span>

  <span class='kw'>unless</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_can_mine?'>can_mine?</span><span class='lparen'>(</span><span class='ivar'>@resource_source</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_can_accept?'>can_accept?</span><span class='lparen'>(</span><span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_mining_quantity'>mining_quantity</span><span class='rparen'>)</span>
    <span class='ivar'>@remove</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='comment'># must issue subsequent mining requests
</span>    <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>

    <span class='comment'># ship &amp; resource are too far apart or in different systems
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>||</span>
        <span class='lparen'>(</span><span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span> <span class='op'>-</span> <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_mining_distance'>mining_distance</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>mining_distance_exceeded</span><span class='tstring_end'>'</span></span>

    <span class='comment'># ship is at max capacity
</span>    <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_cargo_quantity'>cargo_quantity</span> <span class='op'>+</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_mining_quantity'>mining_quantity</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_cargo_capacity'>cargo_capacity</span>
      <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship_cargo_full</span><span class='tstring_end'>'</span></span>

    <span class='comment'># ship has become docked
</span>    <span class='kw'>elsif</span> <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_docked?'>docked?</span>
      <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship_docked</span><span class='tstring_end'>'</span></span>

    <span class='kw'>elsif</span> <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
      <span class='const'>RJR</span><span class='op'>::</span><span class='const'>Logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'> depleted resource </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>, marking for removal</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_notification_callbacks'>notification_callbacks</span><span class='period'>.</span>
            <span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='symbol'>:resource_depleted</span><span class='rbrace'>}</span><span class='period'>.</span>
            <span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
        <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_invoke'>invoke</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>resource_depleted</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='ivar'>@ship</span><span class='comma'>,</span> <span class='ivar'>@resource_source</span>
      <span class='rbrace'>}</span>

      <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>resource_depleted</span><span class='tstring_end'>'</span></span>

    <span class='kw'>end</span>

    <span class='const'>RJR</span><span class='op'>::</span><span class='const'>Logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ship </span><span class='embexpr_beg'>#{</span><span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'> cannot continue mining due to: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reason'>reason</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

    <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_notification_callbacks'>notification_callbacks</span><span class='period'>.</span>
          <span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='symbol'>:mining_stopped</span> <span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_each'>each</span>   <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
      <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_invoke'>invoke</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>mining_stopped</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='ivar'>@ship</span><span class='comma'>,</span> <span class='ivar'>@resource_source</span>
    <span class='rbrace'>}</span>

    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='ivar'>@last_time_mined</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>

  <span class='id identifier rubyid_removed_resource'>removed_resource</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_resource_transferred'>resource_transferred</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>-=</span> <span class='id identifier rubyid_mining_quantity'>mining_quantity</span>
    <span class='id identifier rubyid_removed_resource'>removed_resource</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_add_resource'>add_resource</span> <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_mining_quantity'>mining_quantity</span>
    <span class='id identifier rubyid_resource_transferred'>resource_transferred</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='ivar'>@resource_source</span><span class='period'>.</span><span class='id identifier rubyid_quantity'>quantity</span> <span class='op'>+=</span> <span class='id identifier rubyid_mining_quantity'>mining_quantity</span> <span class='kw'>if</span> <span class='id identifier rubyid_removed_resource'>removed_resource</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_resource_transferred'>resource_transferred</span>
    <span class='ivar'>@ship</span><span class='period'>.</span><span class='id identifier rubyid_notification_callbacks'>notification_callbacks</span><span class='period'>.</span>
          <span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='symbol'>:resource_collected</span><span class='rbrace'>}</span><span class='period'>.</span>
          <span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
      <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_invoke'>invoke</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>resource_collected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='ivar'>@ship</span><span class='comma'>,</span> <span class='ivar'>@resource_source</span><span class='comma'>,</span> <span class='id identifier rubyid_mining_quantity'>mining_quantity</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remove?-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>remove?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Returns boolean indicating if this mining command should be removed</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/manufactured/commands.rb', line 312</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove?'>remove?</span>
  <span class='ivar'>@remove</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Nov 25 08:35:33 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.3).
</div>

  </body>
</html>